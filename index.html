<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Simple Webpage</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Welcome to My Page</h1>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#weather-apps">Weather</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home">
            <h2>Home</h2>
            <p>This is a simple webpage created with HTML and CSS.</p>
        </section>

        <section id="weather-apps" class="weather-container">
            <h2>ğŸŒ¦ Open-Meteo Weather Applications</h2>

            <div class="weather-app-box">
                <h3>ğŸ“ Current Weather</h3>
                <div class="input-group">
                    <input type="text" id="city-current" placeholder="City name (e.g. Bucharest, London)" value="Bucharest">
                    <button onclick="getCurrentWeather()">Get Weather</button>
                </div>
                <div id="current-weather-result" class="result-box"></div>
            </div>

            <div class="weather-app-box">
                <h3>ğŸ“… 7-Day Forecast</h3>
                <div class="input-group">
                    <input type="text" id="city-forecast" placeholder="City name (e.g. Bucharest, London)" value="Bucharest">
                    <button onclick="getWeekForecast()">Get Forecast</button>
                </div>
                <div id="forecast-result" class="result-box"></div>
            </div>

            <div class="weather-app-box">
                <h3>ğŸŒ¡ Hourly Temperature (Next 24h)</h3>
                <div class="input-group">
                    <input type="text" id="city-hourly" placeholder="City name (e.g. Bucharest, London)" value="Bucharest">
                    <button onclick="getHourlyTemperature()">Get Hourly Data</button>
                </div>
                <div id="hourly-result" class="result-box"></div>
            </div>

            <div class="weather-app-box">
                <h3>ğŸ’¨ Air Quality Index</h3>
                <div class="input-group">
                    <input type="text" id="city-air" placeholder="City name (e.g. Bucharest, London)" value="Bucharest">
                    <button onclick="getAirQuality()">Check Air Quality</button>
                </div>
                <div id="air-quality-result" class="result-box"></div>
            </div>
        </section>

        <section id="about">
            <h2>About</h2>
            <p>Learn more about what we do.</p>
        </section>

        <section id="contact">
            <h2>Contact</h2>
            <p>Get in touch with us!</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 My Simple Webpage. All rights reserved.</p>
    </footer>

    <script>
        async function getCoordinates(cityName) {
            const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityName)}&count=1&language=en&format=json`);
            const data = await response.json();

            if (!data.results || data.results.length === 0) {
                throw new Error('City not found. Please check the spelling.');
            }

            return {
                lat: data.results[0].latitude,
                lon: data.results[0].longitude,
                name: data.results[0].name,
                country: data.results[0].country,
                admin1: data.results[0].admin1
            };
        }

        const weatherCodes = {
            0: 'â˜€ Clear sky', 1: 'ğŸŒ¤ Mainly clear', 2: 'â›… Partly cloudy', 3: 'â˜ Overcast',
            45: 'ğŸŒ« Foggy', 48: 'ğŸŒ« Depositing rime fog', 51: 'ğŸŒ¦ Light drizzle',
            53: 'ğŸŒ¦ Moderate drizzle', 55: 'ğŸŒ¦ Dense drizzle', 61: 'ğŸŒ§ Slight rain',
            63: 'ğŸŒ§ Moderate rain', 65: 'ğŸŒ§ Heavy rain', 71: 'ğŸŒ¨ Slight snow',
            73: 'ğŸŒ¨ Moderate snow', 75: 'ğŸŒ¨ Heavy snow', 77: 'â„ Snow grains',
            80: 'ğŸŒ¦ Slight rain showers', 81: 'ğŸŒ¦ Moderate rain showers',
            82: 'ğŸŒ¦ Violent rain showers', 85: 'ğŸŒ¨ Slight snow showers',
            86: 'ğŸŒ¨ Heavy snow showers', 95: 'â›ˆ Thunderstorm',
            96: 'â›ˆ Thunderstorm with slight hail', 99: 'â›ˆ Thunderstorm with heavy hail'
        };

        async function getCurrentWeather() {
            const cityName = document.getElementById('city-current').value;
            const resultDiv = document.getElementById('current-weather-result');

            resultDiv.innerHTML = '<p class="loading">Loading...</p>';

            try {
                const location = await getCoordinates(cityName);

                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&current_weather=true&timezone=auto`);
                const data = await response.json();
                const weather = data.current_weather;

                resultDiv.innerHTML = `
              <div class="weather-data">
                <p><strong>ğŸ“ Location:</strong> ${location.name}, ${location.country}</p>
                <p><strong>ğŸŒ¡ Temperature:</strong> ${weather.temperature}Â°C</p>
                <p><strong>ğŸ’¨ Wind Speed:</strong> ${weather.windspeed} km/h</p>
                <p><strong>ğŸ§­ Wind Direction:</strong> ${weather.winddirection}Â°</p>
                <p><strong>ğŸŒ¤ Condition:</strong> ${weatherCodes[weather.weathercode] || 'Unknown'}</p>
                <p><strong>ğŸ• Time:</strong> ${weather.time}</p>
              </div>
            `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ Error: ${error.message}</p>`;
            }
        }

        async function getWeekForecast() {
            const cityName = document.getElementById('city-forecast').value;
            const resultDiv = document.getElementById('forecast-result');
            resultDiv.innerHTML = '<p class="loading">Loading...</p>';

            try {
                const location = await getCoordinates(cityName);
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto`);
                const data = await response.json();

                let forecastHTML = `<p style="text-align: center; margin-bottom: 1rem;"><strong>ğŸ“ ${location.name}, ${location.country}</strong></p>`;
                forecastHTML += '<div class="forecast-grid">';

                for (let i = 0; i < 7; i++) {
                    const date = new Date(data.daily.time[i]);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });

                    forecastHTML += `
                <div class="forecast-day">
                  <p><strong>${dayName}</strong></p>
                  <p>${date.toLocaleDateString()}</p>
                  <p>ğŸŒ¡ ${data.daily.temperature_2m_max[i]}Â°C / ${data.daily.temperature_2m_min[i]}Â°C</p>
                  <p>ğŸ’§ ${data.daily.precipitation_sum[i]} mm</p>
                </div>
              `;
                }

                forecastHTML += '</div>';
                resultDiv.innerHTML = forecastHTML;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ Error: ${error.message}</p>`;
            }
        }

        async function getHourlyTemperature() {
            const cityName = document.getElementById('city-hourly').value;
            const resultDiv = document.getElementById('hourly-result');
            resultDiv.innerHTML = '<p class="loading">Loading...</p>';

            try {
                const location = await getCoordinates(cityName);
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&hourly=temperature_2m,relative_humidity_2m,precipitation&timezone=auto&forecast_days=1`);
                const data = await response.json();

                let hourlyHTML = `<p style="text-align: center; margin-bottom: 1rem;"><strong>ğŸ“ ${location.name}, ${location.country}</strong></p>`;
                hourlyHTML += '<div class="hourly-grid">';

                for (let i = 0; i < 24; i++) {
                    const time = new Date(data.hourly.time[i]);
                    const hour = time.getHours();

                    hourlyHTML += `
                <div class="hourly-item">
                  <p><strong>${hour}:00</strong></p>
                  <p>ğŸŒ¡ ${data.hourly.temperature_2m[i]}Â°C</p>
                  <p>ğŸ’§ ${data.hourly.relative_humidity_2m[i]}%</p>
                  <p>ğŸŒ§ ${data.hourly.precipitation[i]} mm</p>
                </div>
              `;
                }

                hourlyHTML += '</div>';
                resultDiv.innerHTML = hourlyHTML;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ Error: ${error.message}</p>`;
            }
        }

        // PASUL 7: indexul calitÄƒÈ›ii aerului
        async function getAirQuality() {
            const cityName = document.getElementById('city-air').value;
            const resultDiv = document.getElementById('air-quality-result');
            resultDiv.innerHTML = '<p class="loading">Loading...</p>';

            try {
                const location = await getCoordinates(cityName);
                const response = await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${location.lat}&longitude=${location.lon}&current=pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone,european_aqi&timezone=auto`);
                const data = await response.json();

                const current = data.current;
                const aqiLevels = {
                    1: 'âœ… Good',
                    2: 'ğŸŸ¢ Fair',
                    3: 'ğŸŸ¡ Moderate',
                    4: 'ğŸŸ  Poor',
                    5: 'ğŸ”´ Very Poor'
                };

                function mapEuropeanAqiToLevel(aqi) {
                    if (aqi <= 20) return 1;   // Good
                    if (aqi <= 40) return 2;   // Fair
                    if (aqi <= 60) return 3;   // Moderate
                    if (aqi <= 80) return 4;   // Poor
                    return 5;                  // Very Poor (80+)
                }

                const levelIndex = mapEuropeanAqiToLevel(current.european_aqi);

                resultDiv.innerHTML = `
              <div class="weather-data">
                <p><strong>ğŸ“ Location:</strong> ${location.name}, ${location.country}</p>
                <p><strong>European AQI:</strong> ${aqiLevels[levelIndex]} (${current.european_aqi.toFixed(1)})</p>
                <p><strong>PM10:</strong> ${current.pm10} Î¼g/mÂ³</p>
                <p><strong>PM2.5:</strong> ${current.pm2_5} Î¼g/mÂ³</p>
                <p><strong>CO:</strong> ${current.carbon_monoxide} Î¼g/mÂ³</p>
                <p><strong>NOâ‚‚:</strong> ${current.nitrogen_dioxide} Î¼g/mÂ³</p>
                <p><strong>SOâ‚‚:</strong> ${current.sulphur_dioxide} Î¼g/mÂ³</p>
                <p><strong>Oâ‚ƒ:</strong> ${current.ozone} Î¼g/mÂ³</p>
              </div>
            `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
